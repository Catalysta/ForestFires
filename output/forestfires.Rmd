---
title: "Forest Fires"
author: "Christina Sousa"
date: "March 12, 2019"
output: html_document
---
#Introduction

This data is about forest fires and it's very interesting! [add more background info]

The data are from forest fires occuring in the Montesinho National Park in northeast Portugal between January 2000 and December 2003. They come to us by way of Paulo Cortez and Anibal Morais at the University of Minho, in Guimaraes, Portugal. Our goal is to use 12 predictors to model the total burned area of forest fires within the park. This will hopefully give insight as to what conditions might indicate more severe or larger fires.

At each fire occurrence, a fire inspector recorded the date and and time of the fire, as well as the spatial location of the fire within the park boundaries. They also recorded the type of vegetation, weather conditions, total burn area, and six components of the Fire Weather Index (FWI), a Canadian system for rating fire danger. These included Fine Fuel Moisture Code (FFMC), Duff Moisture Code (DMC), Drought Code (DC), Initial Spread Index (ISI), Buildup Index (BUI) and FWI. The FFMC variable pertains to the moisture content of surface litter; the DMC and DC variable pertain to the "moisture content of shallow and deep organic layers" [cite main paper]; the ISI variable pertains to fire velocity spread; and finally the BUI variable pertains to the amount of available fuel. These various codes and scores each contribute to the final FWI score. Although the individual elements are not measured on the same scale, higher values indicate greater danger of fire in all cases. 

The variables in the data are given by:

   1. X - x-axis spatial coordinate within the Montesinho park map: 1 to 9
   2. Y - y-axis spatial coordinate within the Montesinho park map: 2 to 9
   3. month - month of the year: "jan" to "dec" 
   4. day - day of the week: "mon" to "sun"
   5. FFMC - FFMC index from the FWI system: 18.7 to 96.20
   6. DMC - DMC index from the FWI system: 1.1 to 291.3 
   7. DC - DC index from the FWI system: 7.9 to 860.6 
   8. ISI - ISI index from the FWI system: 0.0 to 56.10
   9. temp - temperature in Celsius degrees: 2.2 to 33.30
   10. RH - relative humidity in %: 15.0 to 100
   11. wind - wind speed in km/h: 0.40 to 9.40 
   12. rain - outside rain in mm/m2 : 0.0 to 6.4 
   13. area - the burned area of the forest (in ha): 0.00 to 1090.84 
   (this output variable is very skewed towards 0.0, thus it may make
    sense to model with the logarithm transform).
    
#Exploratory Data Analysis

We begin the analysis by reading in the data and plotting it.


```{r}
#data file can be obtained at https://archive.ics.uci.edu/ml/machine-learning-databases/forest-fires/
#read data into r
forest <-read.csv("forestfires.csv")
head(forest)
pairs(forest)
```

It is notable that there are 247 records with an `area` value of 0. The values of `area` also range over several orders of magnitude. This suggests a log transformation of the response will be useful. This is explained by Cortez and Morais as a general trend with forest fire data observed in various locations: either the fires are extinguished quickly and burn less than $100m^2$ of area, or they are not easily contained and end up burning a large area.

There is also a trend with respect to observation order here: this is likely due to the fact that when combining the two data sets, the first set was sorted by `area`, while the second set was ordered chronologically.

```{r}
length(which(forest$area==0))
plot(forest$area)
plot(log(forest$area+1))

```


We log transform `area` and replot the data:

```{r}
forest2<-cbind(forest[,1:12],log(forest$area+1))
colnames(forest2)[13]<-"Larea"
pairs(forest2)
```

There are also many data points for which the value of `rain` is zero. This makes sense, considering that forest fires are probably more likely to break out on dry days. Still, this variable might also indicate lightning storms, which can also cause a fire to break out. It might make sense to convert this to a factor variable rather than a numeric variable, or even a binomial variable with "rain"=1 and "no rain"=0.

There appear to be some outliers, particularly  in `area`, `rain`, `ISI`, and `FFMC`. We investigate further.

```{r}

which(forest$area>600)
which(forest$rain>5)
which(forest$ISI>40)
which(forest$FFMC<20)
forest[c(239,416,500,23,380),]

# We can calculate the Cooks distances to verify which points may be influential.
cooks.distances<-cooks.distance(lm(Larea~.,dat=forest2))
summary(cooks.distances)
which(cooks.distances>.5)
cooks.distances[c(239,416,500,23,380)]
qf(0.5,ncol(forest2)+1,nrow(forest2)-ncol(forest2)-1)

```

It appears that the outlier in `rain` is indeed influential, hence we remove that observation.

```{r}
forest3<-forest2[-500,]
pairs(forest3)
```

We recalculate the Cook's Distances with this observation removed. These look much better now.

```{r}
cooks.distances2<-cooks.distance(lm(Larea~.,dat=forest3))
summary(cooks.distances2)
which(cooks.distances2>.5)
```

Note that `DMC` and `DC` appear to be linearly correlated. There may also be correlation between `temp` and `ISI` and `RH` and `temp`. This is probably because temperature is used in the calculation of these indexes. There also appears to be an interesting curvilinear relationship between `DMC` and `FFMC` as well as `DMC` and `ISI`. Indeed it seems like these individual indexes have a good deal of overlap. We generate a correlation matrix to check for linear dependence. It appears that `DC` and `DMC`, `temp` and `DC`, and `FFMC` and `ISI` have somewhat high linear correlation, along with `temp` and `RH`. Also `temp` and `DMC` appear to be somewhat linearly correlated. To summarize, there is quite a bit of multicollinearity in this data. This may be because the fire indexes are in part based on the various weather variables, and  because weather variables such as temperature and humidity are related to one another.

```{r}
cor(forest3[,-c(1,2,3,4)])
summary(cor(forest3[,-c(1,2,3,4)]))
```

There do not appear to be any immediately evident variables that look like strong predictors for `Larea`. We proceed to seeking out suitable transformations of these variables that may reveal more evidence, by applying the Yeo-Johnson method. Note that some of the variable values have zero values, so the Box-Cox method won't work for this data. The `car` package function `powerTransform` indeed suggests that some transformations may be in order.

```{r}
require(car)
summary(forest3)
summary(powerTransform(cbind(FFMC,DMC,DC,ISI,temp,RH,wind,rain)~1,forest3,family="yjPower"))

```


```{r}
forest4<-forest3[which(forest3$Larea>0),]
pairs(forest4)
```


#Citations

P. Cortez and A. Morais. A Data Mining Approach to Predict Forest Fires using Meteorological Data. 
  In J. Neves, M. F. Santos and J. Machado Eds., New Trends in Artificial Intelligence, 
  Proceedings of the 13th EPIA 2007 - Portuguese Conference on Artificial Intelligence, December, 
  Guimaraes, Portugal, pp. 512-523, 2007. APPIA, ISBN-13 978-989-95618-0-9. 